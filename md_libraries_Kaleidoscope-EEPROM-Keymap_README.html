<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Kaleidoscope: Kaleidoscope-EEPROM-Keymap</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kaleidoscope
   </div>
   <div id="projectbrief">Customizable firmware for keyboards</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Kaleidoscope-EEPROM-Keymap </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://img.shields.io/badge/stable-âœ”-black.svg?style=flat&colorA=44cc11&colorB=494e52"  alt="status"/>
</div>
<p> <a href="https://travis-ci.org/keyboardio/Kaleidoscope-EEPROM-Keymap">![Build Status][travis:image]</a></p>
<p>While keyboards usually ship with a keymap programmed in, to be able to change that keymap, without flashing new firmware, we need a way to place the keymap into a place we can update at run-time, and which persists across reboots. Fortunately, we have a bit of <code>EEPROM</code> on the keyboard, and can use it to store either the full keymap (and saving space in the firmware then), or store an overlay there. In the latter case, whenever there is a non-transparent key on the overlay, we will use that instead of the keyboard default.</p>
<p>In short, this plugin allows us to change our keymaps, without having to compile and flash new firmware. It does so through the use of the <a href="https://github.com/keyboardio/Kaleidoscope-Focus">Focus</a> plugin.</p>
<p>#</p>
<h1>Using the plugin</h1>
<p>Using the plugin is reasonably simple: after including the header, enable the plugin, and let the <code>Layer</code> object know that we'll be using <code>EEPROMKeymap</code> to figure out which keys to use. We can either use the <code>getKeyOverride</code> or the <code>getKey</code> method, depending on whether we want to override, or fully replace the built-in keymap. Then we need to set at most how many layers we want to store in <code>EEPROM</code>, and that is about it.</p>
<p>We can then update the keymap via <a href="https://github.com/keyboardio/Kaleidoscope-Focus">Focus</a>.</p>
<p>```c++ #include &lt;<a class="el" href="Kaleidoscope_8h_source.html">Kaleidoscope.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-EEPROM-Keymap_8h_source.html">Kaleidoscope-EEPROM-Keymap.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-EEPROM-Settings_8h_source.html">Kaleidoscope-EEPROM-Settings.h</a>&gt; #include &lt;<a class="el" href="Kaleidoscope-Focus_8h_source.html">Kaleidoscope-Focus.h</a>&gt;</p>
<p>void setup() { Serial.begin(9600); Kaleidoscope.use(&amp;EEPROMKeymap, &amp;Focus);</p>
<p>Kaleidoscope.setup();</p>
<p>Focus.addHook(FOCUS_HOOK_KEYMAP); Focus.addHook(FOCUS_HOOK_KEYMAP_TRANSFER);</p>
<p>Layer.getKey = EEPROMKeymap.getKeyOverride;</p>
<p>EEPROMKeymap.max_layers(1); EEPROMSettings.seal(); } ```</p>
<h2>Plugin methods</h2>
<p>The plugin provides the <code>EEPROMKeymap</code> object, which has the following methods:</p>
<h3><code>.max_layers(max)</code></h3>
<blockquote class="doxtable">
<p>Tells the extension to reserve space in EEPROM for up to <code>max</code> layers. Can only be called once, any subsequent call will be a no-op. This should be set to the number of keymap layers you want to be able to program from EEPROM (probably the number of layers you have defined in your keymap).</p>
<p></p>
</blockquote>
<h2>Focus commands</h2>
<p>The plugin provides three <code>Focus</code> hooks: <code>FOCUS_HOOK_KEYMAP</code>, <code>FOCUS_HOOK_KEYMAP_LAYER</code>, and <code>FOCUS_HOOK_KEYMAP_TRANSFER</code>. Together, they make the following commands available, respectively:</p>
<h3><code>keymap.map [codes...]</code></h3>
<blockquote class="doxtable">
<p>Without arguments, displays the keymap currently in effect. Each key is printed as its raw, 16-bit keycode.</p>
<p>With arguments, it stores as many keys as given. One does not need to set all keys, on all layers: the command will start from the first key on the first layer, and go on as long as it has input. It will not go past the layer set via the <code>.max_layers()</code> method.</p>
<p></p>
</blockquote>
<h3><code>keymap.layer LAYER [codes...]</code></h3>
<blockquote class="doxtable">
<p>Without codes, prints the keymap for the given layer (zero-indexed). Prints each key as its raw 16-bit keycode.</p>
<p></p>
</blockquote>
<blockquote class="doxtable">
<p>With codes, stores them as the keymap for the given layer.</p>
<p></p>
</blockquote>
<h3><code>keymap.transfer LAYER</code></h3>
<blockquote class="doxtable">
<p>Transfers the <code>LAYER</code> from the built-in memory of the keyboard into <code>EEPROM</code> storage.</p>
<p>Useful mostly when one wants to remove the built-in keymap, and wants to easily transfer it into <code>EEPROM</code> first.</p>
<p>This is generally not needed, and it is recommended to not enable this command, unless the feature this command implements is truly needed.</p>
<p></p>
</blockquote>
<h2>Dependencies</h2>
<ul>
<li><a href="https://github.com/keyboardio/Kaleidoscope-EEPROM-Settings">Kaleidoscope-EEPROM-Settings</a></li>
<li><a href="https://github.com/keyboardio/Kaleidoscope-Focus">Kaleidoscope-Focus</a></li>
</ul>
<h2>Further reading</h2>
<p>Starting from the <a href="https://github.com/keyboardio/Kaleidoscope-EEPROM-Keymap/blob/master/examples/EEPROM-Keymap/EEPROM-Keymap.ino">example</a> is the recommended way of getting started with the plugin. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
